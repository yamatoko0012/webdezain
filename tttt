<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solo TRPG KP Assistant</title>
    <style>
        :root {
            --main-bg-color: #f7f7f7;
            --container-bg-color: #ffffff;
            --kp-color: #0a4f78;
            --player-color: #8c0000;
            --border-color: #dddddd;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --padding-unit: 10px;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--main-bg-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            width: 95%;
            max-width: 1000px; /* PCã§ã®è¦–èªæ€§ã‚’è€ƒæ…®ã—ãŸæœ€å¤§å¹… */
            background-color: var(--container-bg-color);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 20px;
            box-sizing: border-box;
        }

        h1 {
            text-align: center;
            color: var(--kp-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* ã‚·ãƒŠãƒªã‚ªå…¥åŠ›ã‚¨ãƒªã‚¢ */
        #scenario-setup {
            margin-bottom: 20px;
            padding: var(--padding-unit);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: #fafafa;
        }

        #scenario-input {
            width: 100%;
            min-height: 200px;
            padding: var(--padding-unit);
            margin-bottom: var(--padding-unit);
            border: 1px solid #cccccc;
            border-radius: 4px;
            resize: vertical;
            font-size: 14px;
        }

        #start-button {
            display: block;
            width: 100%;
            padding: 10px 15px;
            background-color: var(--kp-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        #start-button:hover {
            background-color: #073a5a;
        }

        /* ãƒ—ãƒ¬ã‚¤ã‚¨ãƒªã‚¢ */
        #game-area {
            display: none; /* åˆæœŸçŠ¶æ…‹ã§ã¯éè¡¨ç¤º */
            border-top: 2px dashed var(--border-color);
            padding-top: 20px;
        }

        #log-display {
            height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            padding: var(--padding-unit);
            margin-bottom: var(--padding-unit);
            border-radius: 4px;
            background-color: #ffffff;
            line-height: 1.6;
        }

        .message {
            margin-bottom: 15px;
            padding: 8px 12px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .kp-message {
            background-color: #e0f7fa;
            color: var(--kp-color);
            margin-right: auto;
            border-bottom-left-radius: 0;
            position: relative;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.05);
        }

        .player-message {
            background-color: #ffebee;
            color: var(--player-color);
            margin-left: auto;
            border-bottom-right-radius: 0;
            text-align: right;
            position: relative;
            box-shadow: -1px 1px 3px rgba(0,0,0,0.05);
        }

        .message strong {
            display: block;
            font-size: 0.9em;
            margin-bottom: 3px;
            opacity: 0.7;
            font-weight: 600;
        }

        /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */
        #action-form {
            display: flex;
        }

        #action-input {
            flex-grow: 1;
            padding: var(--padding-unit);
            border: 1px solid #ccc;
            border-radius: 4px 0 0 4px;
            font-size: 14px;
        }

        #send-button {
            padding: var(--padding-unit) 15px;
            background-color: var(--player-color);
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        #send-button:hover {
            background-color: #6e0000;
        }

        .system-message {
            text-align: center;
            color: gray;
            font-style: italic;
            margin: 10px 0;
            font-size: 0.9em;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                align-items: stretch;
            }
            .container {
                width: 100%;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® Solo TRPG KP ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ ğŸ“œ</h1>

        <div id="scenario-setup">
            <h2>1. ã‚·ãƒŠãƒªã‚ªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
            <textarea id="scenario-input" placeholder="ã“ã“ã«ã€KPã«èª­ã¾ã›ãŸã„ã‚·ãƒŠãƒªã‚ªã®æ¦‚è¦ã€ç™»å ´äººç‰©ã€åˆæœŸé…ç½®ã€åˆ¤å®šãƒ«ãƒ¼ãƒ«ãªã©ã‚’è©³ã—ãè¨˜è¿°ã—ã¦ãã ã•ã„ã€‚ä¾‹ï¼š&#10;[ã‚·ãƒŠãƒªã‚ªåï¼šéœ§ã®ä¸­ã®æ´‹é¤¨]&#10;[ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç›®çš„ï¼šè„±å‡º]&#10;[åˆæœŸå ´æ‰€ï¼šæ´‹é¤¨ã®ã‚¨ãƒ³ãƒˆãƒ©ãƒ³ã‚¹]&#10;[ç‰¹æ®Šãƒ«ãƒ¼ãƒ«ï¼šSANãƒã‚§ãƒƒã‚¯ã¯1d100ã§50ä»¥ä¸‹æˆåŠŸ]&#10;ã€ã‚ãªãŸã¯æ·±ã„éœ§ã«åŒ…ã¾ã‚ŒãŸå¤ã„æ´‹é¤¨ã®ã‚¨ãƒ³ãƒˆãƒ©ãƒ³ã‚¹ã«ç«‹ã£ã¦ã„ã¾ã™ã€‚ç›®ã®å‰ã«ã¯åˆ†åšã„æ‰‰ã¨ã€å¥¥ã¸ç¶šãå»Šä¸‹ãŒè¦‹ãˆã¾ã™ã€‚ã©ã†ã—ã¾ã™ã‹ï¼Ÿã€"></textarea>
            <button id="start-button">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
        </div>

        <div id="game-area">
            <h2>2. ã‚²ãƒ¼ãƒ ãƒ­ã‚°</h2>
            <div id="log-display">
                <div class="system-message">ã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€KPã‹ã‚‰ã®æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
            </div>
            
            <form id="action-form">
                <input type="text" id="action-input" placeholder="ã‚ãªãŸã®è¡Œå‹•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šå»Šä¸‹ã«é€²ã‚€ã€æ‰‰ã‚’èª¿ã¹ã‚‹ï¼‰" required>
                <button type="submit" id="send-button">è¡Œå‹•</button>
            </form>
        </div>
    </div>

    <script>
        // DOMè¦ç´ ã®å–å¾—
        const scenarioInput = document.getElementById('scenario-input');
        const startButton = document.getElementById('start-button');
        const scenarioSetup = document.getElementById('scenario-setup');
        const gameArea = document.getElementById('game-area');
        const logDisplay = document.getElementById('log-display');
        const actionForm = document.getElementById('action-form');
        const actionInput = document.getElementById('action-input');

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®å¤‰æ•°
        let isGameStarted = false;
        let currentScenarioText = '';
        let gameLog = [];
        
        // KPã®å¿œç­”ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•°
        function generateKpResponse(playerAction) {
            // **ã€é‡è¦ã€‘** ã“ã“ã«ã€AIï¼ˆGPTãªã©ã®è¨€èªãƒ¢ãƒ‡ãƒ«ï¼‰ã®APIå‘¼ã³å‡ºã—ã‚„ã€
            // è¤‡é›‘ãªãƒ«ãƒ¼ãƒ«å‡¦ç†ã€ä¹±æ•°åˆ¤å®šã®ãƒ­ã‚¸ãƒƒã‚¯ãŒæœ¬æ¥ã¯å¿…è¦ã«ãªã‚Šã¾ã™ã€‚
            // GitHubã§ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹å ´åˆã€ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹é–¢æ•°ã‚„å¤–éƒ¨APIã‚’å‘¼ã³å‡ºã™ã“ã¨ã«ãªã‚Šã¾ã™ãŒã€
            // ã“ã®ç´ æœ´ãªHTML/JSã®ã‚³ãƒ¼ãƒ‰ã§ã¯**æ“¬ä¼¼çš„ãªå¿œç­”**ã«ãªã‚Šã¾ã™ã€‚

            // ç°¡æ˜“çš„ãªå¿œç­”ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            let response = '';
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¡Œå‹•ãƒ†ã‚­ã‚¹ãƒˆã‚’åˆ†æï¼ˆéå¸¸ã«ç°¡å˜ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°ã®ä¾‹ï¼‰
            const lowerAction = playerAction.toLowerCase();

            if (lowerAction.includes('èª¿ã¹ã‚‹') || lowerAction.includes('èª¿æŸ»')) {
                // ç°¡æ˜“åˆ¤å®šï¼ˆ1d100ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰
                const diceRoll = Math.floor(Math.random() * 100) + 1;
                response += `KP: è¡Œå‹•ã€Œ${playerAction}ã€ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚èª¿æŸ»åˆ¤å®šï¼ˆ1d100ï¼‰ã‚’è¡Œã„ã¾ã™... **å‡ºç›®: ${diceRoll}**ã€‚`;
                
                if (diceRoll <= 50) { // ä¾‹ã¨ã—ã¦50ä»¥ä¸‹ã‚’æˆåŠŸã¨ã™ã‚‹
                    response += `\nKP: æˆåŠŸã§ã™ã€‚ã‚ãªãŸã¯ç†±å¿ƒã«èª¿ã¹ã€**å¤ã³ãŸéµ**ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚`;
                } else {
                    response += `\nKP: å¤±æ•—ã§ã™ã€‚ä½•ã‚‚è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€é ãã§**ä½•ã‹ã®ç‰©éŸ³**ãŒèã“ãˆãŸæ°—ãŒã—ã¾ã™ã€‚`;
                }
            } else if (lowerAction.includes('é€²ã‚€') || lowerAction.includes('ç§»å‹•') || lowerAction.includes('å»Šä¸‹')) {
                response += `KP: ã‚ãªãŸã¯æ…é‡ã«å»Šä¸‹ã‚’é€²ã¿ã¾ã™ã€‚å»Šä¸‹ã¯é•·ãã€å·¦å³ã«æ‰‰ãŒä¸¦ã‚“ã§ã„ã¾ã™ã€‚`;
                response += `\nKP: **å·¦ã®æ‰‰**ã€**å³ã®æ‰‰**ã€ã©ã¡ã‚‰ã‚’èª¿ã¹ã¾ã™ã‹ï¼Ÿ`;
            } else if (lowerAction.includes('è©±ã™') || lowerAction.includes('å«ã¶')) {
                response += `KP: ã‚ãªãŸã®å£°ã¯ã€æ¹¿ã£ãŸæ´‹é¤¨ã®å£ã«å¸ã„è¾¼ã¾ã‚Œã€ã“ã ã¾ã¨ãªã£ã¦è¿”ã£ã¦ãã‚‹ã ã‘ã§ã™ã€‚å¿œãˆã‚‹è€…ã¯ã„ã¾ã›ã‚“ã€‚`;
            } else if (playerAction.length < 5) {
                 response += `KP: ãã®è¡Œå‹•ã§ã¯æƒ…å ±ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚ã‚‚ã†å°‘ã—å…·ä½“çš„ã«è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚`;
            } else {
                response += `KP: ã‚ãªãŸã¯${playerAction}ã¾ã—ãŸã€‚ç‰¹ã«çŠ¶æ³ã¯å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚æ¬¡ã«ã©ã†ã—ã¾ã™ã‹ï¼Ÿ`;
            }

            // æœ¬æ¥ã¯currentScenarioTextï¼ˆã‚·ãƒŠãƒªã‚ªæœ¬æ–‡ï¼‰ã¨gameLogï¼ˆéå»ã®çµŒç·¯ï¼‰ã‚’
            // è€ƒæ…®ã—ãŸã€ã‚ˆã‚Šè¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ãŒå¿…è¦ã§ã™ã€‚
            // ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹é–¢æ•°ã‚„å¤–éƒ¨APIï¼ˆä¾‹ï¼šOpenAI APIï¼‰ã‚’ä½¿ç”¨ã™ã‚Œã°ã€
            // ã“ã®éƒ¨åˆ†ã‚’AIã«ç½®ãæ›ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

            return response;
        }

        // ãƒ­ã‚°è¡¨ç¤ºã®æ›´æ–°
        function updateLog(speaker, message) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            
            let nameTag = '';
            if (speaker === 'KP') {
                messageDiv.classList.add('kp-message');
                nameTag = '<strong>ã‚­ãƒ¼ãƒ‘ãƒ¼ã‹ã‚‰ã®å¿œç­”</strong>';
            } else {
                messageDiv.classList.add('player-message');
                nameTag = '<strong>ã‚ãªãŸã®è¡Œå‹•</strong>';
            }

            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœ¬æ–‡ã‚’æ•´å½¢ï¼ˆæ”¹è¡Œã‚’åæ˜ ï¼‰
            const formattedMessage = message.replace(/\n/g, '<br>');

            messageDiv.innerHTML = `${nameTag} ${formattedMessage}`;
            logDisplay.appendChild(messageDiv);
            
            // æœ€æ–°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            logDisplay.scrollTop = logDisplay.scrollHeight;

            // ãƒ­ã‚°ã®è¨˜éŒ²ï¼ˆçŠ¶æ…‹ç®¡ç†ï¼‰
            gameLog.push({ speaker: speaker, message: message, timestamp: new Date().toISOString() });
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        startButton.addEventListener('click', () => {
            const scenarioText = scenarioInput.value.trim();
            if (scenarioText === '') {
                alert('KPã¨ã—ã¦é€²è¡Œã™ã‚‹ãŸã‚ã®ã‚·ãƒŠãƒªã‚ªæœ¬æ–‡ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            // çŠ¶æ…‹ã®æ›´æ–°
            isGameStarted = true;
            currentScenarioText = scenarioText;
            gameLog = []; // ãƒ­ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ

            // UIã®åˆ‡ã‚Šæ›¿ãˆ
            scenarioSetup.style.display = 'none';
            gameArea.style.display = 'block';
            logDisplay.innerHTML = ''; // ãƒ­ã‚°è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢
            actionInput.focus(); // å…¥åŠ›æ¬„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹

            // æœ€åˆã®KPãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆï¼ˆã‚·ãƒŠãƒªã‚ªã®å°å…¥éƒ¨åˆ†ã‚’æµç”¨ï¼‰
            // ã“ã“ã§ã¯ç°¡æ˜“çš„ã«ã€ã‚·ãƒŠãƒªã‚ªã®æœ€åˆã®æ•°è¡Œã‚’å°å…¥ã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚
            const initialKpMessage = scenarioText.split('\n').find(line => line.includes('ã€') && line.includes('ã€')) || 
                                     "ã€ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‘ã‚·ãƒŠãƒªã‚ªãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸã€‚ã‚ãªãŸã®è¡Œå‹•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
            
            updateLog('KP', initialKpMessage.replace(/ã€|ã€/g, '')); // å¼•ç”¨ç¬¦ã‚’é™¤å»ã—ã¦è¡¨ç¤º
        });

        // è¡Œå‹•ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        actionForm.addEventListener('submit', (event) => {
            event.preventDefault(); // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé€ä¿¡ã‚’é˜²æ­¢
            
            if (!isGameStarted) {
                alert('å…ˆã«ã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚·ãƒŠãƒªã‚ªã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„ã€‚');
                return;
            }

            const playerAction = actionInput.value.trim();
            if (playerAction === '') {
                alert('è¡Œå‹•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¡Œå‹•ã‚’ãƒ­ã‚°ã«è¡¨ç¤º
            updateLog('Player', playerAction);

            // KPã®å¿œç­”ã‚’ç”Ÿæˆï¼ˆéåŒæœŸå‡¦ç†ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ãŸã‚setTimeoutã‚’ä½¿ç”¨ï¼‰
            // å®Ÿéš›ã«ã¯ã€ã“ã“ã§APIã‚³ãƒ¼ãƒ«ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
            actionInput.disabled = true; // å¿œç­”å¾…ã¡ã®é–“ã€å…¥åŠ›ã‚’ç„¡åŠ¹åŒ–
            actionInput.placeholder = 'KPãŒè€ƒãˆä¸­ã§ã™...';

            setTimeout(() => {
                const kpResponse = generateKpResponse(playerAction);
                updateLog('KP', kpResponse);
                
                // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆã—ã€å†æœ‰åŠ¹åŒ–
                actionInput.value = '';
                actionInput.disabled = false;
                actionInput.placeholder = 'ã‚ãªãŸã®è¡Œå‹•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šå»Šä¸‹ã«é€²ã‚€ã€æ‰‰ã‚’èª¿ã¹ã‚‹ï¼‰';
                actionInput.focus();
            }, 1500); // 1.5ç§’å¾…æ©Ÿï¼ˆæ€è€ƒæ™‚é–“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
        });

        // **ã€ã•ã‚‰ãªã‚‹æ©Ÿèƒ½æ‹¡å¼µã®ãŸã‚ã®æº–å‚™ã€‘**
        // ä»¥ä¸‹ã®é–¢æ•°ã¯ã€ãƒ€ã‚¤ã‚¹ãƒ­ãƒ¼ãƒ«ãªã©ã®TRPGæ©Ÿèƒ½ã‚’æ‹¡å¼µã™ã‚‹éš›ã«ä½¿ç”¨ã§ãã¾ã™ã€‚
        function rollDice(sides = 6) {
            return Math.floor(Math.random() * sides) + 1;
        }

        function rollD100() {
            return rollDice(100);
        }

        // çŠ¶æ…‹ä¿å­˜ï¼ˆLocal Storageãªã©ã‚’ä½¿ç”¨ã™ã‚Œã°ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã‚‚ç¶™ç¶šå¯èƒ½ï¼‰
        function saveGameState() {
            // localStorage.setItem('trpgGameLog', JSON.stringify(gameLog));
            // localStorage.setItem('trpgScenario', currentScenarioText);
        }

        function loadGameState() {
            // const savedLog = localStorage.getItem('trpgGameLog');
            // ... ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        }
        
    </script>
</body>
</html>
